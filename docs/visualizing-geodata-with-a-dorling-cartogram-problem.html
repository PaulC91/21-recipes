<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>21 Recipes for Mining Twitter Data with rtweet</title>
  <meta name="description" content="An R/rtweet edition of Matthew A. Russell’s Python Twitter Recipes Book">
  <meta name="generator" content="bookdown 0.5.10 and GitBook 2.6.7">

  <meta property="og:title" content="21 Recipes for Mining Twitter Data with rtweet" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://rud.is/books/21-recipes/" />
  
  <meta property="og:description" content="An R/rtweet edition of Matthew A. Russell’s Python Twitter Recipes Book" />
  <meta name="github-repo" content="hrbrmstr/21-recipes" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="21 Recipes for Mining Twitter Data with rtweet" />
  
  <meta name="twitter:description" content="An R/rtweet edition of Matthew A. Russell’s Python Twitter Recipes Book" />
  

<meta name="author" content="Bob Rudis">


<meta name="date" content="2018-01-03">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="analyzing-the-authors-of-tweets-that-appear-in-search-results.html">
<link rel="next" href="geocoding-locations-from-profiles-or-elsewhere.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceLine, a.sourceLine { display: inline-block; min-height: 1.25em; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; }
@media print {
code.sourceCode { white-space: pre-wrap; }
div.sourceLine, a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource div.sourceLine, .numberSource a.sourceLine
  { position: relative; }
pre.numberSource div.sourceLine::before, .numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em; }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; color: #aaaaaa;  padding-left: 4px; }
@media screen {
a.sourceLine::before { text-decoration: underline; color: initial; }
}
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.bn { color: #40a070; } /* BaseN */
code span.fl { color: #40a070; } /* Float */
code span.ch { color: #4070a0; } /* Char */
code span.st { color: #4070a0; } /* String */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.ot { color: #007020; } /* Other */
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.fu { color: #06287e; } /* Function */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code span.cn { color: #880000; } /* Constant */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.ss { color: #bb6688; } /* SpecialString */
code span.im { } /* Import */
code span.va { color: #19177c; } /* Variable */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.op { color: #666666; } /* Operator */
code span.bu { } /* BuiltIn */
code span.ex { } /* Extension */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.at { color: #7d9029; } /* Attribute */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">21 Recipes for Mining Twitter with rtweet</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="about-the-author.html"><a href="about-the-author.html"><i class="fa fa-check"></i>About the Author</a></li>
<li class="chapter" data-level="1" data-path="using-oauth-to-access-twitter-apis.html"><a href="using-oauth-to-access-twitter-apis.html"><i class="fa fa-check"></i><b>1</b> Using OAuth to Access Twitter APIs</a><ul>
<li class="chapter" data-level="1.1" data-path="using-oauth-to-access-twitter-apis.html"><a href="using-oauth-to-access-twitter-apis.html#problem"><i class="fa fa-check"></i><b>1.1</b> Problem</a></li>
<li class="chapter" data-level="1.2" data-path="using-oauth-to-access-twitter-apis.html"><a href="using-oauth-to-access-twitter-apis.html#solution"><i class="fa fa-check"></i><b>1.2</b> Solution</a></li>
<li class="chapter" data-level="1.3" data-path="using-oauth-to-access-twitter-apis.html"><a href="using-oauth-to-access-twitter-apis.html#discussion"><i class="fa fa-check"></i><b>1.3</b> Discussion</a></li>
<li class="chapter" data-level="1.4" data-path="using-oauth-to-access-twitter-apis.html"><a href="using-oauth-to-access-twitter-apis.html#see-also"><i class="fa fa-check"></i><b>1.4</b> See Also</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="looking-up-the-trending-topics.html"><a href="looking-up-the-trending-topics.html"><i class="fa fa-check"></i><b>2</b> Looking Up the Trending Topics</a><ul>
<li class="chapter" data-level="2.1" data-path="looking-up-the-trending-topics.html"><a href="looking-up-the-trending-topics.html#problem-1"><i class="fa fa-check"></i><b>2.1</b> Problem</a></li>
<li class="chapter" data-level="2.2" data-path="looking-up-the-trending-topics.html"><a href="looking-up-the-trending-topics.html#solution-1"><i class="fa fa-check"></i><b>2.2</b> Solution</a></li>
<li class="chapter" data-level="2.3" data-path="looking-up-the-trending-topics.html"><a href="looking-up-the-trending-topics.html#discussion-1"><i class="fa fa-check"></i><b>2.3</b> Discussion</a></li>
<li class="chapter" data-level="2.4" data-path="looking-up-the-trending-topics.html"><a href="looking-up-the-trending-topics.html#see-also-1"><i class="fa fa-check"></i><b>2.4</b> See Also</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="extracting-tweet-entities.html"><a href="extracting-tweet-entities.html"><i class="fa fa-check"></i><b>3</b> Extracting Tweet Entities</a><ul>
<li class="chapter" data-level="3.1" data-path="extracting-tweet-entities.html"><a href="extracting-tweet-entities.html#problem-2"><i class="fa fa-check"></i><b>3.1</b> Problem</a></li>
<li class="chapter" data-level="3.2" data-path="extracting-tweet-entities.html"><a href="extracting-tweet-entities.html#solution-2"><i class="fa fa-check"></i><b>3.2</b> Solution</a></li>
<li class="chapter" data-level="3.3" data-path="extracting-tweet-entities.html"><a href="extracting-tweet-entities.html#discussion-2"><i class="fa fa-check"></i><b>3.3</b> Discussion</a></li>
<li class="chapter" data-level="3.4" data-path="extracting-tweet-entities.html"><a href="extracting-tweet-entities.html#see-also-2"><i class="fa fa-check"></i><b>3.4</b> See Also</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="searching-for-tweets.html"><a href="searching-for-tweets.html"><i class="fa fa-check"></i><b>4</b> Searching for Tweets</a><ul>
<li class="chapter" data-level="4.1" data-path="searching-for-tweets.html"><a href="searching-for-tweets.html#problem-3"><i class="fa fa-check"></i><b>4.1</b> Problem</a></li>
<li class="chapter" data-level="4.2" data-path="searching-for-tweets.html"><a href="searching-for-tweets.html#solution-3"><i class="fa fa-check"></i><b>4.2</b> Solution</a></li>
<li class="chapter" data-level="4.3" data-path="searching-for-tweets.html"><a href="searching-for-tweets.html#discussion-3"><i class="fa fa-check"></i><b>4.3</b> Discussion</a></li>
<li class="chapter" data-level="4.4" data-path="searching-for-tweets.html"><a href="searching-for-tweets.html#see-also-3"><i class="fa fa-check"></i><b>4.4</b> See Also</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="extracting-a-retweets-origins.html"><a href="extracting-a-retweets-origins.html"><i class="fa fa-check"></i><b>5</b> Extracting a Retweet’s Origins</a><ul>
<li class="chapter" data-level="5.1" data-path="extracting-a-retweets-origins.html"><a href="extracting-a-retweets-origins.html#problem-4"><i class="fa fa-check"></i><b>5.1</b> Problem</a></li>
<li class="chapter" data-level="5.2" data-path="extracting-a-retweets-origins.html"><a href="extracting-a-retweets-origins.html#solution-4"><i class="fa fa-check"></i><b>5.2</b> Solution</a></li>
<li class="chapter" data-level="5.3" data-path="extracting-a-retweets-origins.html"><a href="extracting-a-retweets-origins.html#discussion-4"><i class="fa fa-check"></i><b>5.3</b> Discussion</a></li>
<li class="chapter" data-level="5.4" data-path="extracting-a-retweets-origins.html"><a href="extracting-a-retweets-origins.html#see-also-4"><i class="fa fa-check"></i><b>5.4</b> See Also</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="creating-a-graph-of-retweet-relationships.html"><a href="creating-a-graph-of-retweet-relationships.html"><i class="fa fa-check"></i><b>6</b> Creating a Graph of Retweet Relationships</a><ul>
<li class="chapter" data-level="6.1" data-path="creating-a-graph-of-retweet-relationships.html"><a href="creating-a-graph-of-retweet-relationships.html#problem-5"><i class="fa fa-check"></i><b>6.1</b> Problem</a></li>
<li class="chapter" data-level="6.2" data-path="creating-a-graph-of-retweet-relationships.html"><a href="creating-a-graph-of-retweet-relationships.html#solution-5"><i class="fa fa-check"></i><b>6.2</b> Solution</a></li>
<li class="chapter" data-level="6.3" data-path="creating-a-graph-of-retweet-relationships.html"><a href="creating-a-graph-of-retweet-relationships.html#discussion-5"><i class="fa fa-check"></i><b>6.3</b> Discussion</a></li>
<li class="chapter" data-level="6.4" data-path="creating-a-graph-of-retweet-relationships.html"><a href="creating-a-graph-of-retweet-relationships.html#see-also-5"><i class="fa fa-check"></i><b>6.4</b> See Also</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="visualizing-a-graph-of-retweet-relationships.html"><a href="visualizing-a-graph-of-retweet-relationships.html"><i class="fa fa-check"></i><b>7</b> Visualizing a Graph of Retweet Relationships</a><ul>
<li class="chapter" data-level="7.1" data-path="visualizing-a-graph-of-retweet-relationships.html"><a href="visualizing-a-graph-of-retweet-relationships.html#problem-6"><i class="fa fa-check"></i><b>7.1</b> Problem</a></li>
<li class="chapter" data-level="7.2" data-path="visualizing-a-graph-of-retweet-relationships.html"><a href="visualizing-a-graph-of-retweet-relationships.html#solution-6"><i class="fa fa-check"></i><b>7.2</b> Solution</a></li>
<li class="chapter" data-level="7.3" data-path="visualizing-a-graph-of-retweet-relationships.html"><a href="visualizing-a-graph-of-retweet-relationships.html#see-also-6"><i class="fa fa-check"></i><b>7.3</b> See Also</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="capturing-tweets-in-real-time-with-the-streaming-api.html"><a href="capturing-tweets-in-real-time-with-the-streaming-api.html"><i class="fa fa-check"></i><b>8</b> Capturing Tweets in Real-time with the Streaming API</a><ul>
<li class="chapter" data-level="8.1" data-path="capturing-tweets-in-real-time-with-the-streaming-api.html"><a href="capturing-tweets-in-real-time-with-the-streaming-api.html#problem-7"><i class="fa fa-check"></i><b>8.1</b> Problem</a></li>
<li class="chapter" data-level="8.2" data-path="capturing-tweets-in-real-time-with-the-streaming-api.html"><a href="capturing-tweets-in-real-time-with-the-streaming-api.html#solution-7"><i class="fa fa-check"></i><b>8.2</b> Solution</a></li>
<li class="chapter" data-level="8.3" data-path="capturing-tweets-in-real-time-with-the-streaming-api.html"><a href="capturing-tweets-in-real-time-with-the-streaming-api.html#discussion-6"><i class="fa fa-check"></i><b>8.3</b> Discussion</a></li>
<li class="chapter" data-level="8.4" data-path="capturing-tweets-in-real-time-with-the-streaming-api.html"><a href="capturing-tweets-in-real-time-with-the-streaming-api.html#see-also-7"><i class="fa fa-check"></i><b>8.4</b> See Also</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="making-robust-twitter-requests.html"><a href="making-robust-twitter-requests.html"><i class="fa fa-check"></i><b>9</b> Making Robust Twitter Requests</a><ul>
<li class="chapter" data-level="9.1" data-path="making-robust-twitter-requests.html"><a href="making-robust-twitter-requests.html#problem-8"><i class="fa fa-check"></i><b>9.1</b> Problem</a></li>
<li class="chapter" data-level="9.2" data-path="making-robust-twitter-requests.html"><a href="making-robust-twitter-requests.html#solution-8"><i class="fa fa-check"></i><b>9.2</b> Solution</a></li>
<li class="chapter" data-level="9.3" data-path="making-robust-twitter-requests.html"><a href="making-robust-twitter-requests.html#discussion-7"><i class="fa fa-check"></i><b>9.3</b> Discussion</a></li>
<li class="chapter" data-level="9.4" data-path="making-robust-twitter-requests.html"><a href="making-robust-twitter-requests.html#see-also-8"><i class="fa fa-check"></i><b>9.4</b> See Also</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="harvesting-tweets.html"><a href="harvesting-tweets.html"><i class="fa fa-check"></i><b>10</b> Harvesting Tweets</a><ul>
<li class="chapter" data-level="10.1" data-path="harvesting-tweets.html"><a href="harvesting-tweets.html#problem-9"><i class="fa fa-check"></i><b>10.1</b> Problem</a></li>
<li class="chapter" data-level="10.2" data-path="harvesting-tweets.html"><a href="harvesting-tweets.html#solution-9"><i class="fa fa-check"></i><b>10.2</b> Solution</a></li>
<li class="chapter" data-level="10.3" data-path="harvesting-tweets.html"><a href="harvesting-tweets.html#discussion-8"><i class="fa fa-check"></i><b>10.3</b> Discussion</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="creating-a-tag-cloud-from-tweet-entities.html"><a href="creating-a-tag-cloud-from-tweet-entities.html"><i class="fa fa-check"></i><b>11</b> Creating a Tag Cloud from Tweet Entities</a><ul>
<li class="chapter" data-level="11.1" data-path="creating-a-tag-cloud-from-tweet-entities.html"><a href="creating-a-tag-cloud-from-tweet-entities.html#problem-10"><i class="fa fa-check"></i><b>11.1</b> Problem</a></li>
<li class="chapter" data-level="11.2" data-path="creating-a-tag-cloud-from-tweet-entities.html"><a href="creating-a-tag-cloud-from-tweet-entities.html#solution-10"><i class="fa fa-check"></i><b>11.2</b> Solution</a></li>
<li class="chapter" data-level="11.3" data-path="creating-a-tag-cloud-from-tweet-entities.html"><a href="creating-a-tag-cloud-from-tweet-entities.html#discussion-9"><i class="fa fa-check"></i><b>11.3</b> Discussion</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="summarizing-link-targets.html"><a href="summarizing-link-targets.html"><i class="fa fa-check"></i><b>12</b> Summarizing Link Targets</a><ul>
<li class="chapter" data-level="12.1" data-path="summarizing-link-targets.html"><a href="summarizing-link-targets.html#problem-11"><i class="fa fa-check"></i><b>12.1</b> Problem</a></li>
<li class="chapter" data-level="12.2" data-path="summarizing-link-targets.html"><a href="summarizing-link-targets.html#solution-11"><i class="fa fa-check"></i><b>12.2</b> Solution</a></li>
<li class="chapter" data-level="12.3" data-path="summarizing-link-targets.html"><a href="summarizing-link-targets.html#discussion-10"><i class="fa fa-check"></i><b>12.3</b> Discussion</a></li>
<li class="chapter" data-level="12.4" data-path="summarizing-link-targets.html"><a href="summarizing-link-targets.html#see-also-9"><i class="fa fa-check"></i><b>12.4</b> See Also</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="harvesting-friends-and-followers.html"><a href="harvesting-friends-and-followers.html"><i class="fa fa-check"></i><b>13</b> Harvesting Friends and Followers</a><ul>
<li class="chapter" data-level="13.1" data-path="harvesting-friends-and-followers.html"><a href="harvesting-friends-and-followers.html#problem-12"><i class="fa fa-check"></i><b>13.1</b> Problem</a></li>
<li class="chapter" data-level="13.2" data-path="harvesting-friends-and-followers.html"><a href="harvesting-friends-and-followers.html#solution-12"><i class="fa fa-check"></i><b>13.2</b> Solution</a></li>
<li class="chapter" data-level="13.3" data-path="harvesting-friends-and-followers.html"><a href="harvesting-friends-and-followers.html#discussion-11"><i class="fa fa-check"></i><b>13.3</b> Discussion</a></li>
<li class="chapter" data-level="13.4" data-path="harvesting-friends-and-followers.html"><a href="harvesting-friends-and-followers.html#see-also-10"><i class="fa fa-check"></i><b>13.4</b> See Also</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="performing-setwise-operations-on-friendship-data.html"><a href="performing-setwise-operations-on-friendship-data.html"><i class="fa fa-check"></i><b>14</b> Performing Setwise Operations on Friendship Data</a><ul>
<li class="chapter" data-level="14.1" data-path="performing-setwise-operations-on-friendship-data.html"><a href="performing-setwise-operations-on-friendship-data.html#problem-13"><i class="fa fa-check"></i><b>14.1</b> Problem</a></li>
<li class="chapter" data-level="14.2" data-path="performing-setwise-operations-on-friendship-data.html"><a href="performing-setwise-operations-on-friendship-data.html#solution-13"><i class="fa fa-check"></i><b>14.2</b> Solution</a></li>
<li class="chapter" data-level="14.3" data-path="performing-setwise-operations-on-friendship-data.html"><a href="performing-setwise-operations-on-friendship-data.html#discussion-12"><i class="fa fa-check"></i><b>14.3</b> Discussion</a></li>
<li class="chapter" data-level="14.4" data-path="performing-setwise-operations-on-friendship-data.html"><a href="performing-setwise-operations-on-friendship-data.html#see-also-11"><i class="fa fa-check"></i><b>14.4</b> See Also</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="resolving-user-profile-information.html"><a href="resolving-user-profile-information.html"><i class="fa fa-check"></i><b>15</b> Resolving User Profile Information</a><ul>
<li class="chapter" data-level="15.1" data-path="resolving-user-profile-information.html"><a href="resolving-user-profile-information.html#problem-14"><i class="fa fa-check"></i><b>15.1</b> Problem</a></li>
<li class="chapter" data-level="15.2" data-path="resolving-user-profile-information.html"><a href="resolving-user-profile-information.html#solution-14"><i class="fa fa-check"></i><b>15.2</b> Solution</a></li>
<li class="chapter" data-level="15.3" data-path="resolving-user-profile-information.html"><a href="resolving-user-profile-information.html#discussion-13"><i class="fa fa-check"></i><b>15.3</b> Discussion</a></li>
<li class="chapter" data-level="15.4" data-path="resolving-user-profile-information.html"><a href="resolving-user-profile-information.html#see-also-12"><i class="fa fa-check"></i><b>15.4</b> See Also</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="analyzing-the-authors-of-tweets-that-appear-in-search-results.html"><a href="analyzing-the-authors-of-tweets-that-appear-in-search-results.html"><i class="fa fa-check"></i><b>16</b> Analyzing the Authors of Tweets that Appear in Search Results</a><ul>
<li class="chapter" data-level="16.1" data-path="analyzing-the-authors-of-tweets-that-appear-in-search-results.html"><a href="analyzing-the-authors-of-tweets-that-appear-in-search-results.html#problem-15"><i class="fa fa-check"></i><b>16.1</b> Problem</a></li>
<li class="chapter" data-level="16.2" data-path="analyzing-the-authors-of-tweets-that-appear-in-search-results.html"><a href="analyzing-the-authors-of-tweets-that-appear-in-search-results.html#solution-15"><i class="fa fa-check"></i><b>16.2</b> Solution</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="visualizing-geodata-with-a-dorling-cartogram-problem.html"><a href="visualizing-geodata-with-a-dorling-cartogram-problem.html"><i class="fa fa-check"></i><b>17</b> Visualizing Geodata with a Dorling Cartogram Problem</a><ul>
<li class="chapter" data-level="17.1" data-path="visualizing-geodata-with-a-dorling-cartogram-problem.html"><a href="visualizing-geodata-with-a-dorling-cartogram-problem.html#problem-16"><i class="fa fa-check"></i><b>17.1</b> Problem</a></li>
<li class="chapter" data-level="17.2" data-path="visualizing-geodata-with-a-dorling-cartogram-problem.html"><a href="visualizing-geodata-with-a-dorling-cartogram-problem.html#solution-16"><i class="fa fa-check"></i><b>17.2</b> Solution</a></li>
<li class="chapter" data-level="17.3" data-path="visualizing-geodata-with-a-dorling-cartogram-problem.html"><a href="visualizing-geodata-with-a-dorling-cartogram-problem.html#discussion-14"><i class="fa fa-check"></i><b>17.3</b> Discussion</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="geocoding-locations-from-profiles-or-elsewhere.html"><a href="geocoding-locations-from-profiles-or-elsewhere.html"><i class="fa fa-check"></i><b>18</b> Geocoding Locations from Profiles (or Elsewhere)</a><ul>
<li class="chapter" data-level="18.1" data-path="geocoding-locations-from-profiles-or-elsewhere.html"><a href="geocoding-locations-from-profiles-or-elsewhere.html#problem-17"><i class="fa fa-check"></i><b>18.1</b> Problem</a></li>
<li class="chapter" data-level="18.2" data-path="geocoding-locations-from-profiles-or-elsewhere.html"><a href="geocoding-locations-from-profiles-or-elsewhere.html#solution-17"><i class="fa fa-check"></i><b>18.2</b> Solution</a></li>
<li class="chapter" data-level="18.3" data-path="geocoding-locations-from-profiles-or-elsewhere.html"><a href="geocoding-locations-from-profiles-or-elsewhere.html#discussion-15"><i class="fa fa-check"></i><b>18.3</b> Discussion</a></li>
<li class="chapter" data-level="18.4" data-path="geocoding-locations-from-profiles-or-elsewhere.html"><a href="geocoding-locations-from-profiles-or-elsewhere.html#see-also-13"><i class="fa fa-check"></i><b>18.4</b> See Also</a></li>
</ul></li>
<li class="divider"></li>
<li><span style="font-size:8pt"><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></span></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">21 Recipes for Mining Twitter Data with rtweet</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="visualizing-geodata-with-a-dorling-cartogram-problem" class="section level1">
<h1><span class="header-section-number">Recipe 17</span> Visualizing Geodata with a Dorling Cartogram Problem</h1>
<div id="problem-16" class="section level2">
<h2><span class="header-section-number">17.1</span> Problem</h2>
<p>You want to visualize geolocation information (for example, the location field from user profile information, included in a batch of tweets such as a search query), in order to determine if there is a correlation between location and some other criterion.</p>
</div>
<div id="solution-16" class="section level2">
<h2><span class="header-section-number">17.2</span> Solution</h2>
<p>Devise a heuristic to extract the state from the location information in user profiles and visualize it with a Dorling Cartogram.</p>
</div>
<div id="discussion-14" class="section level2">
<h2><span class="header-section-number">17.3</span> Discussion</h2>
<p>(As this cookbook’s Python counterpart notes): <em>“A <a href="http://mbostock.github.io/protovis/ex/cartogram.html">Dorling Cartogram</a> is essentially a bubble chart where each bubble corresponds to a geographic area such as a state, and each bubble is situated as close as possible to its actual location on a map without overlapping with any other bubbles. Since the size and/or color of each bubble can be used to represent meaningful things, a Dorling Cartogram can give you a very intuitive view of data as it relates to geographic boundaries or regions of a larger land mass. The Protovis toolkit comes with some machinery for creating Dorling Cartograms for locations in the United States, and one interesting example of something that you could do builds upon Recipe 19, which demonstrated an approach that you could use to analyze the users who authored tweets from a targeted query.”</em></p>
<p>One seminal, modern example for Dorling catograms is Mike Bostock’s Protovis (a pre-cursor to D3) <a href="http://mbostock.github.io/protovis/ex/cartogram.html">version</a></p>
<p><img src="figures/20-protovis.png" /></p>
<p>I have a love/hate relationship with cartograms. On the one hand, they capture attention by preying on the weakness most of us have to maps. On the other hand, most adults in my home country barely know where their state is on a map when they can see its shape, so most cartograms require extensive labeling and the shape distortions can initially disorient the viewer. Many cartograms also degrade the ability to readily discern the proportions or precision of the underlying data. But, we’re working with Twitter data and the goal for this recipe is to pull a sample of tweets and see where the (geographic) action is at, so using this paticular cartogram style for it is not a terrible choice.</p>
<blockquote>
<p>NOTE: This recipe and the next (and, final!) recipe both cover Twitter and geographic data. Any reasonable person should disable the association of location information to Tweets for a whole host of reasons which include security and safety. They should also make the location information in their profile human discernable but difficult for machines to process (better still — use fake location data in your profile). However, there are still a cadre of Twitter users who gleefully provide this information — or, disinformation — so we all can process it.</p>
</blockquote>
<p>Rather than rely on the geolocation data of a tweet, let’s pull down some more <code>#rstats</code> tweets and try to limit the locations of the tweets to just the U.S. (despite disabling assocation of location data, Twitter can still internally, generally figure out where you’re tweeting from, especially if you’re on a mobile device).</p>
<p>After that, we’ll lookup the users of the tweets and extract the location information from their user profile.</p>
<p>Once we have that location information, we’ll filter it a bit to discern which state it came from. We’ll cover the visualization component after we deal with the data:</p>
<pre class="sourceCode r" id="cb83"><code class="sourceCode r"><div class="sourceLine" id="cb83-1" data-line-number="1"><span class="kw">library</span>(rtweet)</div>
<div class="sourceLine" id="cb83-2" data-line-number="2"><span class="kw">library</span>(broom)</div>
<div class="sourceLine" id="cb83-3" data-line-number="3"><span class="kw">library</span>(eechidna)</div>
<div class="sourceLine" id="cb83-4" data-line-number="4"><span class="kw">library</span>(cartogram) <span class="co"># chxy/cartogram</span></div>
<div class="sourceLine" id="cb83-5" data-line-number="5"><span class="kw">library</span>(hrbrthemes)</div>
<div class="sourceLine" id="cb83-6" data-line-number="6"><span class="kw">library</span>(tidyverse)</div></code></pre>
<pre class="sourceCode r" id="cb84"><code class="sourceCode r"><div class="sourceLine" id="cb84-1" data-line-number="1"><span class="co"># search twitter for tweets</span></div>
<div class="sourceLine" id="cb84-2" data-line-number="2">rstats_us &lt;-<span class="st"> </span><span class="kw">search_tweets</span>(<span class="st">&quot;#rstats&quot;</span>, <span class="dv">3000</span>, <span class="dt">geocode =</span> <span class="st">&quot;2.877742,-97.380979,3000mi&quot;</span>) <span class="co"># geocode request isn&#39;t perfect but helps narrow down</span></div>
<div class="sourceLine" id="cb84-3" data-line-number="3"></div>
<div class="sourceLine" id="cb84-4" data-line-number="4"><span class="co"># lookup each user (uniquely) so we can grab location information</span></div>
<div class="sourceLine" id="cb84-5" data-line-number="5">user_info &lt;-<span class="st"> </span><span class="kw">lookup_users</span>(<span class="kw">unique</span>(rstats_us<span class="op">$</span>user_id)) </div>
<div class="sourceLine" id="cb84-6" data-line-number="6"></div>
<div class="sourceLine" id="cb84-7" data-line-number="7"><span class="kw">discard</span>(user_info<span class="op">$</span>location, <span class="st">`</span><span class="dt">==</span><span class="st">`</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># ignore blank data</span></div>
<div class="sourceLine" id="cb84-8" data-line-number="8"><span class="st">  </span><span class="kw">str_match</span>(<span class="kw">sprintf</span>(<span class="st">&quot;(%s)&quot;</span>, <span class="kw">paste0</span>(state.abb, <span class="dt">collapse=</span><span class="st">&quot;|&quot;</span>))) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># try to match U.S. state abbreviations</span></div>
<div class="sourceLine" id="cb84-9" data-line-number="9"><span class="st">  </span>.[,<span class="dv">2</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># the previous step creates a matrix with column 2 being the extracted information (if any)</span></div>
<div class="sourceLine" id="cb84-10" data-line-number="10"><span class="st">  </span><span class="kw">discard</span>(is.na) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># if no state match was found the value is NA so discard this one</span></div>
<div class="sourceLine" id="cb84-11" data-line-number="11"><span class="st">  </span><span class="kw">table</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># some habits are hard to break</span></div>
<div class="sourceLine" id="cb84-12" data-line-number="12"><span class="st">  </span>broom<span class="op">::</span><span class="kw">tidy</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># but we can tidy them!</span></div>
<div class="sourceLine" id="cb84-13" data-line-number="13"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">c</span>(<span class="st">&quot;state&quot;</span>, <span class="st">&quot;n&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># these are more representative names</span></div>
<div class="sourceLine" id="cb84-14" data-line-number="14"><span class="st">  </span><span class="kw">tbl_df</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># not really necessary but I was printing this when testing</span></div>
<div class="sourceLine" id="cb84-15" data-line-number="15"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># same as ^^</span></div>
<div class="sourceLine" id="cb84-16" data-line-number="16"><span class="st">  </span><span class="kw">left_join</span>(</div>
<div class="sourceLine" id="cb84-17" data-line-number="17">    <span class="kw">as_data_frame</span>(maps<span class="op">::</span>state.carto.center) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># join state cartographic center data</span></div>
<div class="sourceLine" id="cb84-18" data-line-number="18"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">state=</span>state.abb)</div>
<div class="sourceLine" id="cb84-19" data-line-number="19">  ) <span class="op">%&gt;%</span><span class="st"> </span></div>
<div class="sourceLine" id="cb84-20" data-line-number="20"><span class="st">  </span><span class="co"># the GitHub-only cartogram package nas a data structure which holds state adjacency information</span></div>
<div class="sourceLine" id="cb84-21" data-line-number="21"><span class="st">  </span><span class="co"># by specifying that here, it will help make the force-directed cartogram circle positioning more precise (and pretty)</span></div>
<div class="sourceLine" id="cb84-22" data-line-number="22"><span class="st">  </span><span class="kw">filter</span>(state <span class="op">%in%</span><span class="st"> </span><span class="kw">names</span>(cartogram<span class="op">::</span>statenbrs)) -&gt;<span class="st"> </span>for_dor </div>
<div class="sourceLine" id="cb84-23" data-line-number="23"></div>
<div class="sourceLine" id="cb84-24" data-line-number="24"><span class="kw">glimpse</span>(for_dor)</div></code></pre>
<pre><code>## Observations: 36
## Variables: 4
## $ state &lt;chr&gt; &quot;NY&quot;, &quot;MA&quot;, &quot;PA&quot;, &quot;CA&quot;, &quot;IL&quot;, &quot;NC&quot;, &quot;FL&quot;, &quot;MD&quot;, &quot;TX&quot;, &quot;W...
## $ n     &lt;int&gt; 34, 28, 17, 14, 11, 11, 9, 9, 9, 8, 6, 6, 5, 5, 5, 5, 4,...
## $ x     &lt;dbl&gt; 8.041600, 9.025060, 7.222050, 1.410693, 4.823002, 6.9985...
## $ y     &lt;dbl&gt; 8.746802, 8.684993, 8.029811, 7.337543, 7.757849, 6.5711...</code></pre>
<p>The visualization component needs some explanation since it’s a bit hack-ish. Xiaoyue Cheng has had n R <a href="https://github.com/chxy/cartogram"><code>cartogram</code></a> package on GitHub for just over five years. It’s not feature complete but has a (mostly) working Dorling cartogram generator. <a href="https://github.com/cpsievert">Carson Sievert</a> incorporated and enhanced some of the <code>cartogram</code> functions for the <a href="https://ropensci.org/">rOpenSci</a> <a href="https://github.com/ropenscilabs/eechidna"><code>eechidna</code></a> package, but uses it internally. Finally, <code>cartogram</code> package has some data sets that make Dorling U.S. state cartogramsa bit more visually appealing.</p>
<p>What that all means is we’ll be calling an unexported function from <code>eechidna</code> and using some data from <code>cartogram</code>. This is far from an optimal situation, especially since it also means we won’t be using <code>ggplot2</code> for the final visualization. But, it works!</p>
<p>The code block below starts by setting up some base R plotting parameters, one of which — <code>col=&quot;white&quot;</code> — is going to cause you some grief if you don’t remember to change it to <code>black</code> since it impacts the default color for base R plots. This is also an opportunity to set the font family for the text labels since there is no way to pass text label aesthetics in the <code>dorling()</code> function.</p>
<p>We pass in the:</p>
<ul>
<li>state label</li>
<li>state center</li>
<li>a scaled value for the tweet count</li>
<li>state neighbor information</li>
</ul>
<p>and tweak some aesthetics to produce the final plot. This example opted to “connect the dots” to more explicitly show neighbor information.</p>
<pre class="sourceCode r" id="cb86"><code class="sourceCode r"><div class="sourceLine" id="cb86-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">family=</span>font_rc, <span class="dt">col=</span><span class="st">&quot;white&quot;</span>)</div>
<div class="sourceLine" id="cb86-2" data-line-number="2"></div>
<div class="sourceLine" id="cb86-3" data-line-number="3">eechidna<span class="op">:::</span><span class="kw">dorling</span>(</div>
<div class="sourceLine" id="cb86-4" data-line-number="4">  for_dor<span class="op">$</span>state, for_dor<span class="op">$</span>x, for_dor<span class="op">$</span>y, <span class="kw">sqrt</span>(for_dor<span class="op">$</span>n), <span class="dt">nbr=</span>cartogram<span class="op">::</span>statenbrs, </div>
<div class="sourceLine" id="cb86-5" data-line-number="5">  <span class="dt">animation =</span> <span class="ot">FALSE</span>, <span class="dt">nbredge =</span> <span class="ot">TRUE</span>, <span class="dt">iteration=</span><span class="dv">100</span>, <span class="dt">name.text=</span><span class="ot">TRUE</span>, <span class="dt">dist.ratio=</span><span class="fl">1.2</span>,</div>
<div class="sourceLine" id="cb86-6" data-line-number="6">  <span class="dt">main=</span><span class="st">&quot;Dorling Cartogram of U.S. #rstats&quot;</span>, <span class="dt">xlab=</span><span class="st">&#39;&#39;</span>, <span class="dt">ylab=</span><span class="st">&#39;&#39;</span>, <span class="dt">col=</span><span class="st">&quot;lightslategray&quot;</span>,</div>
<div class="sourceLine" id="cb86-7" data-line-number="7">  <span class="dt">frame=</span><span class="ot">FALSE</span>, <span class="dt">asp=</span><span class="dv">1</span>, <span class="dt">family=</span>font_rc, <span class="dt">cex.main=</span><span class="fl">1.75</span>, <span class="dt">adj=</span><span class="dv">0</span></div>
<div class="sourceLine" id="cb86-8" data-line-number="8">) -&gt;<span class="st"> </span>dor</div></code></pre>
<p><img src="20-Visualizing-Geodata-with-a-Dorling-Cartogram_files/figure-html4/20_dorling_vis-1.png" width="960" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="analyzing-the-authors-of-tweets-that-appear-in-search-results.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="geocoding-locations-from-profiles-or-elsewhere.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "serif",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
},
"theme": "sandstone"
});
});
</script>

</body>

</html>
